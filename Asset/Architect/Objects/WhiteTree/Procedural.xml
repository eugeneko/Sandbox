<procedural>
    <geometry force="true" script="@/Procedural/LeafTextureGeometry.as"    entry="Main" dest="@/Procedural/LeafTextureMask.mdl"/>
    <geometry force="true" script="@/Procedural/FoliageTextureGeometry.as" entry="Main" dest="@/Procedural/FoliageTextureMask.mdl"/>
    <texture force="true">
        <texture name="LeafMask" width="64" height="64" renderpath="Procedural/RenderPaths/BakeOpaque.xml">
            <camera type="BoundingBox" min="-0.5 0.0 -0.5" max="0.5 1.0 0.5" />
            <geometry model="@/Procedural/LeafTextureMask.mdl" materials="Procedural/Materials/MaskAdd.xml" />
        </texture>
        <texture name="FoliageMask" width="1024" height="1024" renderpath="Procedural/RenderPaths/BakeOpaque.xml">
            <camera type="BoundingBox" min="-0.5 0.0 -0.5" max="0.5 1.0 0.5" />
            <geometry model="@/Procedural/FoliageTextureMask.mdl" materials="Procedural/Materials/SuperMask.xml" />
            <input unit="0" texture="LeafMask"/>
        </texture>
        <texture name="cEmpty" color="0 0 0 0"/>
        <texture name="cLeafMain" color="0.204 0.502 0.090"/>
        <texture name="cLeafEdge" color="0.298 0.769 0.090"/>
        <texture name="FoliageDiffuse" width="1024" height="1024" renderpath="Procedural/RenderPaths/BakeTransparent.xml">
            <camera type="BoundingBox" min="0 0 0" max="1 1 1" />
            <geometry model="Procedural/Models/Quad.mdl" materials="Procedural/Materials/MixColor.xml" />
            <input unit="0" texture="FoliageMask"/>
            <input unit="1" texture="cLeafMain"/>
            <input unit="2" texture="cLeafEdge"/>
            <input unit="3" texture="cEmpty"/>
        </texture>
        <output name="LeafMask" file="@/Procedural/LeafMask.png"/>
        <output name="FoliageMask" file="@/Procedural/FoliageMask.png"/>
        <output name="FoliageDiffuse" file="@/Procedural/FoliageDiffuse.png"/>
    </texture>
    <material>
        <uniforms name="main">
            <uniform name="Dithering"        value="200 200"/>
            <uniform name="BranchMagnitude"  value="0.1 0.1"/>
            <uniform name="BranchTurbulence" value="0.666"/>
            <uniform name="BranchPhaseScale" value="0.2"/>
            <uniform name="EdgeMagnitude"    value="0.0175 0.0056"/>
            <uniform name="TrunkMagnitude"   value="0.5"/>
        </uniforms>
        <uniforms name="proxy">
            <uniform name="Dithering"        value="200 200"/>
            <uniform name="FadeBegin"        value="0.88 0.70 0.65"/>
            <uniform name="FadeEnd"          value="0.93 0.80 0.75"/>
            <uniform name="TrunkMagnitude"   value="0.5"/>
            <uniform name="ShadowDepthPad"   value="0.5"/>
        </uniforms>
        <material uniforms="main" source="@/BlackBarkMaterial.xml"    dest="@/LargeBushyTreeBark.xml"/>
        <material uniforms="main" source="@/LargeFoliageMaterial.xml" dest="@/LargeBushyTreeFoliage.xml"/>
    </material>
    <tree1 force="true">
        <output>
            <model>@/LargeBushyTree.mdl</model>
            <lod numLengthSegments="5" numRadialSegments="5"/>
        </output>
        <materials>
            <material>bark</material>
            <material>foliage</material>
        </materials>
        <trunkStrength>0.6</trunkStrength>
        <branches name = "branch_trunk">
            <desc>
                <material name="bark" scale="1 4"/>
                <length>29</length>
                <radius>fit(linear, 0.25, 0.05)</radius>
                <branch_adherence>zero</branch_adherence>
                <geometry_multiplier>2.0</geometry_multiplier>
            </desc>
            <branches name = "branch_main">
                <desc>
                    <material name="bark" scale="1 4"/>
                    <frequency>14</frequency>
                    <length>fit(smleft, 0.3, 0.2)</length>
                    <radius>fit(linear, 0.5, 0.15)</radius>
                    <angle>fit(linear, 60.0, 50.0)</angle>
                    <weight>fit(linear, 0.6, 0.6)</weight>
                    <distrib_function>fit(smleft, 0.8, 1.0)</distrib_function>
                    <location>
                        <from>0.1</from>
                        <to>0.92</to>
                    </location>
                    <distrib>
                        <type>Alternate</type>
                        <angleStep>105.0</angleStep>
                        <angleRandom>25.0</angleRandom>
                    </distrib>
                    <branch_adherence>linear</branch_adherence>
                    <phase_random>1.0</phase_random>
                </desc>
                <branches name = "branch_nested">
                    <desc>
                        <material name="bark" scale="1 4"/>
                        <frequency>3</frequency>
                        <length>fit(linear, 0.5, 0.3, 0.1, 0.7)</length>
                        <radius>fit(linear, 0.6, 0.2)</radius>
                        <angle>fit(linear, 60.0, 60.0)</angle>
                        <weight>fit(smleft, 0.3, 0.3)</weight>
                        <distrib_function>fit(smleft, 1.0, 0.5)</distrib_function>
                        <location>
                            <from>0.1</from>
                            <to>0.7</to>
                        </location>
                        <distrib>
                            <type>Alternate</type>
                            <angleStep>180.0</angleStep>
                            <angleRandom>30.0</angleRandom>
                        </distrib>
                        <branch_adherence>fit(linear, 0.0, 0.5)</branch_adherence>
                    </desc>
                    <fronds size="4.0" adjust="1.0" yaw="60" pitch="45" offset="0 0 -1" gravity="1.0 0.0 3.0" resistance="0.1 0.0 0.1">
                        <material name="foliage"/>
                    </fronds>
                </branches>
                <!--fronds>
                    <material>
                        <name>foliage</name>
                    </material>
                    <size>4.0</size>
                    <location_offset>2.0</location_offset>
                    <center_offset>0.2</center_offset>
                    <spread_angle>45.0</spread_angle>
                </fronds-->
            </branches>
            <!--fronds>
                <material>
                    <name>foliage</name>
                </material>
                <size>4.0</size>
                <location_offset>2.0</location_offset>
                <center_offset>0.2</center_offset>
                <spread_angle>45.0</spread_angle>
            </fronds-->
        </branches>
    </tree1>
    <texture>
        <texture width="2048" height="1024">
            <variation name="ProxyDiffuse" renderpath="Procedural/RenderPaths/BakeDiffuse.xml"/>
            <variation name="ProxyNormal"  renderpath="Procedural/RenderPaths/BakeNormal.xml"/>
            <camera type="cylinderProxy" numSurfaces="8" numVertSegments="3" diagonalAngle="45"/>
            <geometry model="@/LargeBushyTree.mdl" materials="@/BlackBarkMaterial.xml;@/LargeFoliageMaterial.xml"/>
        </texture>
        <output name="ProxyDiffuse" file="@/LargeBushyTreeProxyDiffuse.png"/>
        <output name="ProxyNormal"  file="@/LargeBushyTreeProxyNormal.png"/>
    </texture>

</procedural>
